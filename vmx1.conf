apply-groups openjnpr-container-vmx;
system {
    services {
        extension-service {
            request-response {
                grpc {
                    clear-text {
                        port 50051;
                    }
                }
            }
            notification {
                allow-clients {
                    address 0.0.0.0/0;
                }
            }
        }
    }
}
interfaces {
    ge-0/0/0 {
        unit 0 {
            family inet {
                address 172.20.0.254/24;
            }
            family inet6 {
                address 2001:db8::254/64;
            }
        }
    }
    ge-0/0/1 {
        unit 0 {
            family inet {
                address 172.20.1.254/24;
            }
            family inet6 {
                address 2001:db8:1::254/64;
            }
        }
    }
    ge-0/0/8 {
        unit 0 {
            family inet {
                address 192.168.1.200/24;
            }
        }
    }
}
routing-options {
    autonomous-system 65530;
    forwarding-table {
        export load-balancing-policy;
    }
    programmable-rpd {
        purge-timeout 5;
    }
}
protocols {
    bgp {
        multipath;
        group internal_v4 {
            type internal;
            multihop;
            import accept-all;
            family inet {
                unicast {
                    add-path {
                        receive;
                        send {
                            path-count 6;
                        }
                    }
                }
                any;
            }
            export [ accept-all send-static ];
            neighbor 172.20.0.1 {
                local-address 172.20.0.254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
            neighbor 172.20.1.1 {
                local-address 172.20.1.254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
            neighbor 172.20.0.2 {
                local-address 172.20.0.254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
            neighbor 172.20.1.2 {
                local-address 172.20.1.254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
        }
        group internal_v6 {
            type internal;
            multihop;
            import accept-all;
            family inet6 {
                unicast {
                    add-path {
                        receive;
                        send {
                            path-count 6;
                        }
                    }
                }
            }
            export accept-all;
            neighbor 2001:db8::1 {
                local-address 2001:db8::254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
            neighbor 2001:db8:1::1 {
                local-address 2001:db8:1::254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
            neighbor 2001:db8::2 {
                local-address 2001:db8::254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
            neighbor 2001:db8:1::2 {
                local-address 2001:db8:1::254;
                bfd-liveness-detection {
                    minimum-interval 200;
                }
            }
        }
    }
    lldp {
        interface all;
        interface fxp0 {
            disable;
        }
    }
}
policy-options {
    policy-statement accept-all {
        then accept;
    }
    policy-statement load-balancing-policy {
        then {
            load-balance per-packet;
        }
    }
    policy-statement send-static {
        term 1 {
            from protocol static;
            then accept;
        }
    }
}
snabb-softwire-v2:softwire-config {
    instance 01:00.0 {
        queue 0 {
            external-interface {
                ip 172.20.0.100;
                mac 02:22:22:22:22:00;
                next-hop {
                    ip 172.20.0.2;
                }
            }
            internal-interface {
                ip 2001:db8::100;
                mac 02:22:22:22:22:00;
                next-hop {
                    ip 2001:db8::2;
                }
            }
            passthru-interface {
                device int0;
                mac 00:00:00:00:00:00;
                mtu 9000;
            }
        }
    }
    instance 01:00.1 {
        queue 0 {
            external-interface {
                ip 172.20.1.101;
                mac 02:22:22:22:22:01;
                next-hop {
                    ip 172.20.1.2;
                }
            }
            internal-interface {
                ip 2001:db8:1::101;
                mac 02:22:22:22:22:01;
                next-hop {
                    ip 2001:db8:1::2;
                }
            }
            passthru-interface {
                device int1;
                mac 00:00:00:00:00:00;
                mtu 9000;
            }
        }
    }
    external-interface {
        mtu 9000;
        generate-icmp-errors false;
        error-rate-limiting {
            packets 600000;
        }
        reassembly {
            max-fragments-per-packet 40;
        }
    }
    internal-interface {
        mtu 9000;
        allow-incoming-icmp false;
        generate-icmp-errors false;
        error-rate-limiting {
            packets 300000;
            period 4;
        }
        reassembly {
            max-fragments-per-packet 40;
        }
        hairpinning false;
    }
    binding-table {
        softwire 2001:db8:222::100 {
            ipv4 193.5.2.100;
            psid 1;
            br-address fc00::100;
            port-set {
                psid-length 6;
            }
        }
        softwire 2001:db8:222::1000 {
            ipv4 193.5.2.160;
            psid 61;
            br-address fc00::100;
            port-set {
                psid-length 6;
            }
        }
    }
    jnx-aug-softwire:binding-table-file binding_table_60k.txt;
}
